<head>
<link rel = 'stylesheet' type = 'text/css' href = '../../css/notestyle.css'>
</head>

# 阿里巴巴大数据之路第2章：日志采集

## 日志采集技术
### 页面浏览日志采集
* 操作→请求→服务器响应→浏览器解析响应结果并完成渲染。
* 日志采集技术普遍可以做在第四部分，在解析过程中合适位置添加日志采集结点，解析到节点触发请求日志采集服务器。
* 业务服务器在响应业务请求时动态执行日志采集脚本植入JS脚本到HTML文档内，或开发时提前写好。
* 在JS脚本植入成功后，执行完JS的采集工作，开始对日志服务器的新一次请求→响应→解析过程。
### 页面交互日志采集
* 将交互日志采集代码与需要监测的交互行为绑定，随后一起作为日志内容传输到日志服务器
### 页面日志的服务器端清洗和预处理
* 识别流量攻击、爬虫、作弊行为
* 数据缺项补正（例如：用户登录后，对登录前的页面日志做身份信息回补）
* 无效数据剔除
* 日志隔离分发

## 无线客户端日志采集
* 移动端数据采集除了为了了解用户，还为了分析各类设备信息。
* 利用采集SDK完成，将用户行为分为不同的事件，事件是无线客户端日志行为的最小单元。
* 事先先对事件进行分类，降低后续处理复杂性。
### 页面事件
* 设备用户基本信息、被访问页面信息、访问基本路径（来源）
* 页面展现、退出页面两个接口，展现接口负责记录，退出接口发送日志。额外还有添加页面扩展信息接口，给页面添加相关参数。
* 部分参数还通过透传参数功能实现跨多页面记载，即把当前页面的某些信息，传递到下一个页面甚至下下一个页面日志中。
### 控件点击以及其他事件
* 控件告知采集SDK所需信息即可
* 也可设置自动采集应用崩溃等功能
### 特殊场景
* 为了平衡日志大小，减小流量消耗、降低服务器压力，需在客户端对一部分日志进行适当聚合，减少请求。如商品曝光日志
* 移动端存在大量回退功能，需要利用页面生命周期，识别页面复用，配合栈的深度，识别是否回退，避免对分析造成干扰。
### H5 & Native日志统一
* native+H5页面嵌入APP= hybrid app
* native基于SDK做日志采集，H5基于页面日志方式做采集，数据内容以及服务器均分离，对分析不利，需做统一处理。
* 阿里采用H5统一到Native方式，由H5页面通过采集JS触发接口把所需数据打包到采集SDK内，实现格式统一。再由SDK负责统一推送到日志服务器。
* 好处在于SDK可以获取到更多设备信息，利于分析移动端多样的设备条件。
* 也可以避免网络原因导致的数据丢失
### 设备标识
* 由于很多页面可能不需要用户登录即可查看，所以需要对设备做唯一标识来识别同一使用用户。
### 日志传输
* 日志存储在客户端本地，根据数据情况做分析再进行上传。

## 日志采集挑战
* 日志目前已跨过饥饿阶段，需要按需择食
### 日志分流与定制处理
* 由于日志体量的规模和复杂度，阿里需要尽可能靠前布置路由差异，尽早将数据进行分流，降低日志处理过程中的分支判断消耗，将分流代码更新形成配置化功能，实现高频的分流逻辑变更。
### 采集与计算一体化设计
* 服务于基于日志的后续应用，才是日志采集正确的着眼点。
