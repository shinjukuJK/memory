<head>
<link href = '../../css/notestyle.css' rel = 'stylesheet' type = 'text/css'>
</head>

# 阿里巴巴大数据之路第5章：实时技术
* DT时代（Data Tech），数据要保持最高的新鲜度和价值最大化。
## 简介
* 流式实时处理技术是对离线批处理技术的重要补充，是今年来的热门课题。
* 数据时效性一般分为：离线（粒度为天）、准实时（时）、实时（秒）
### 流式数据处理具有如下特征：  
* 时效性高
* 常驻任务：计算成本较高，数据源无界，数据处理存在一定的局限性
* 性能要求高：木桶效应，处理吞吐量必须跟上采集吞吐量
* 应用局限性：业务逻辑复杂的场景（双流关联或数据回滚）支撑不足，数据到达时间的不确定性导致与离线分析会产生一定差异。
## 流式技术架构
* 流式技术架构在某些环节的技术方案与离线处理是有交叉的，且在业界中有合并的趋势。
### 数据采集
* 业务的日志服务器，采集到数据中间件
* 实时获取数据库变更日志 以及 引擎访问日志
* 数据大小限制（512KB写一批），时间阈值限制（30秒写一批）
* 作为数据中间件一般有两个选择：消息系统、专门的数据中间件，他们的区别是消息系统的时效性在毫秒级，但是吞吐量较低，反之数据中间件的时效性在秒级，吞吐量较高，根据实际需要选用。
### 数据处理
* 下游实时订阅数据，拉取到流式计算系统中加工处理，往往是多线程的
* 以推特开源Storm为例，spout负责拓扑的输入，从中间件读取数据，根据自定义分发规则给到下有bolt
* bolt为业务处理单元。
* 大部分计算所需数据直接放在内存中，定期清理过期数据。
* 需要注意解决以下问题：去重指标、数据倾斜、数据精确处理（防重防超时）
### 数据存储
* 数据实时加工处理后，写入到某个在线服务的存储系统中，为增量操作。
* 整个过程涉及三类数据：中间计算结果，最终结果数据，维表数据
* 表名设计可以遵循：汇总层标识+数据域+主维度+时间维度
* rowkey设计：MD5+主维度+维度标识+子维度1+时间维度+子维度2
### 数据服务
* 存储系统上统一架设数据服务层（HSF接口、HTTP服务），用于获取实时计算结果。
## 流式数据模型
### 数据分层
* ODS、DWD、DWS、ADS、DIM
#### ODS（操作数据层，operate data store）
* 最细的数据粒度，业务系统采集过来的最原始数据。
#### DWD（明细数据层，data warehouse detail）
* 业务过程建模实时事实明细层
#### DWS（汇总数据层，data warehouse summary）
* 在实时任务中计算各个维度的汇总指标，放到实时汇总层。
#### ADS（应用数据层，application data store）
* 存储不是特别通用的统计维度数据，统计垂直创新业务。
#### DIM（）
* 实时维表层，由ODS做离线加工得到。
### 多流关联
* 流式计算中的多流关联设计时序问题，会比之离线存在更多细节
* 基本按照双向查找来解决，即要匹配在一起的AB两表，不管到达顺序，到达后都去查找匹配另一边的数据。注意存在修改时的双流关联的去重。将数据做分桶处理，降低查找数据量。
### 维表使用
* 维表：指某一维度的基础维度表，比如，销售分析中的商品价格表
* 关联维表用实时数据关联T-2的维表数据。
* 维表使用有两种  
  全量加载，将少量的维表数据（如类目维表）直接加载到内存内。  
  增量加载，通过增量查找数据量较大的维表（如会员维表）。
## 大促挑战&保障
* ！待定后续了解！


